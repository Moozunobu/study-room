<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Flappy Character Game</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #70c5ce;
            font-family: 'Arial', sans-serif;
        }
        canvas {
            border: 2px solid #333;
            background-color: #fff;
            max-width: 100%;
            max-height: 100%;
        }
        #ui {
            position: absolute;
            text-align: center;
            pointer-events: none;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
    </style>
</head>
<body>

    <div id="ui">
        <h1 id="msg">クリック / スペースで開始</h1>
        <h2 id="score">Score: 0</h2>
    </div>
    <canvas id="gameCanvas"></canvas>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const msgLabel = document.getElementById('msg');
    const scoreLabel = document.getElementById('score');

    // キャンバスサイズ設定
    canvas.width = 320;
    canvas.height = 480;

    // ゲーム設定
    let gameState = 'START'; // START, PLAYING, GAMEOVER
    let score = 0;
    let frames = 0;

    // キャラクター（鳥）の設定
    const bird = {
        x: 50,
        y: 150,
        width: 40,  // 画像に合わせて調整してください
        height: 40, // 画像に合わせて調整してください
        gravity: 0.25,
        jump: 4.5,
        velocity: 0,
        img: new Image()
    };
    // 指定された画像を読み込み
    bird.img.src = 'IMG_2093-removebg-preview.png'; 

    // 土管の設定
    const pipes = [];
    const pipeWidth = 50;
    const pipeGap = 120; // 土管の隙間

    // 操作イベント
    const handleAction = () => {
        if (gameState === 'START') {
            resetGame();
            gameState = 'PLAYING';
            msgLabel.style.display = 'none';
        } else if (gameState === 'PLAYING') {
            bird.velocity = -bird.jump;
        } else if (gameState === 'GAMEOVER') {
            resetGame();
            gameState = 'START';
            msgLabel.style.display = 'block';
            msgLabel.innerText = 'クリックで再開';
        }
    };

    window.addEventListener('mousedown', handleAction);
    window.addEventListener('keydown', (e) => { if (e.code === 'Space') handleAction(); });

    function resetGame() {
        bird.y = 150;
        bird.velocity = 0;
        pipes.length = 0;
        score = 0;
        frames = 0;
        scoreLabel.innerText = `Score: ${score}`;
    }

    function update() {
        if (gameState !== 'PLAYING') return;

        // 重力計算
        bird.velocity += bird.gravity;
        bird.y += bird.velocity;

        // 床・天井との衝突
        if (bird.y + bird.height > canvas.height || bird.y < 0) {
            gameState = 'GAMEOVER';
            msgLabel.innerText = "GAME OVER";
            msgLabel.style.display = 'block';
        }

        // 土管の生成（100フレームごと）
        if (frames % 100 === 0) {
            let minPipeHeight = 50;
            let maxPipeHeight = canvas.height - pipeGap - minPipeHeight;
            let topHeight = Math.floor(Math.random() * (maxPipeHeight - minPipeHeight + 1)) + minPipeHeight;
            pipes.push({
                x: canvas.width,
                top: topHeight,
                passed: false
            });
        }

        // 土管の移動と判定
        for (let i = pipes.length - 1; i >= 0; i--) {
            pipes[i].x -= 2;

            // 当たり判定
            if (
                bird.x < pipes[i].x + pipeWidth &&
                bird.x + bird.width > pipes[i].x &&
                (bird.y < pipes[i].top || bird.y + bird.height > pipes[i].top + pipeGap)
            ) {
                gameState = 'GAMEOVER';
                msgLabel.innerText = "GAME OVER";
                msgLabel.style.display = 'block';
            }

            // スコア加算
            if (!pipes[i].passed && pipes[i].x + pipeWidth < bird.x) {
                score++;
                pipes[i].passed = true;
                scoreLabel.innerText = `Score: ${score}`;
            }

            // 画面外に出た土管を削除
            if (pipes[i].x + pipeWidth < 0) {
                pipes.splice(i, 1);
            }
        }

        frames++;
    }

    function draw() {
        // 背景クリア
        ctx.fillStyle = "#70c5ce";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // 土管の描画
        ctx.fillStyle = "#2ecc71";
        pipes.forEach(p => {
            // 上の土管
            ctx.fillRect(p.x, 0, pipeWidth, p.top);
            // 下の土管
            ctx.fillRect(p.x, p.top + pipeGap, pipeWidth, canvas.height - (p.top + pipeGap));
        });

        // キャラクター（画像）の描画
        // 画像が読み込まれていない場合は代わりに四角形を描画
        if (bird.img.complete) {
            ctx.drawImage(bird.img, bird.x, bird.y, bird.width, bird.height);
        } else {
            ctx.fillStyle = "yellow";
            ctx.fillRect(bird.x, bird.y, bird.width, bird.height);
        }
    }

    function loop() {
        update();
        draw();
        requestAnimationFrame(loop);
    }

    loop();
</script>
</body>
</html>
